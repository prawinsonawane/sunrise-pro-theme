{{ 'sunrise-cart-drawer.css' | asset_url | stylesheet_tag }}

<cart-drawer class="sunrise-cart-drawer" id="CartDrawer" data-section-id="sunrise-cart-drawer">
  <div class="sunrise-cart-drawer__overlay" id="CartDrawerOverlay"></div>
  
  <div class="sunrise-cart-drawer__content" id="CartDrawerContent">
    <div class="sunrise-cart-drawer__header">
      <h2 class="sunrise-cart-drawer__title">
        {{ 'sections.cart.title' | t }}
        <span class="sunrise-cart-drawer__count" id="CartDrawerCount">
          ({{ cart.item_count }})
        </span>
      </h2>
      <button type="button" class="sunrise-cart-drawer__close" id="CartDrawerClose" aria-label="{{ 'accessibility.close' | t }}">
        <svg class="sunrise-cart-drawer__close-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="sunrise-cart-drawer__body">
      {%- if cart.item_count > 0 -%}
        <form action="{{ routes.cart_url }}" method="post" novalidate class="sunrise-cart-drawer__form" id="CartDrawerForm">
          <div class="sunrise-cart-drawer__items" id="CartDrawerItems">
            {%- for item in cart.items -%}
              <div class="sunrise-cart-drawer__item" id="CartDrawerItem-{{ item.index | plus: 1 }}">
                <div class="sunrise-cart-drawer__item-image">
                  {%- if item.image != blank -%}
                    <a href="{{ item.url }}" class="sunrise-cart-drawer__item-link">
                      {{
                        item.image
                        | image_url: width: 200
                        | image_tag:
                          class: 'sunrise-cart-drawer__item-img',
                          loading: 'lazy',
                          width: 100,
                          height: 100,
                          alt: item.image.alt | escape
                      }}
                    </a>
                  {%- else -%}
                    <div class="sunrise-cart-drawer__item-placeholder">
                      {{ 'product-1' | placeholder_svg_tag: 'sunrise-cart-drawer__item-placeholder-svg' }}
                    </div>
                  {%- endif -%}
                </div>

                <div class="sunrise-cart-drawer__item-details">
                  <h3 class="sunrise-cart-drawer__item-title">
                    <a href="{{ item.url }}" class="sunrise-cart-drawer__item-title-link">
                      {{ item.product.title | escape }}
                    </a>
                  </h3>

                  {%- if item.variant.title != 'Default Title' -%}
                    <div class="sunrise-cart-drawer__item-variant">
                      {{ item.variant.title }}
                    </div>
                  {%- endif -%}

                  {%- if item.selling_plan_allocation -%}
                    <div class="sunrise-cart-drawer__item-subscription">
                      {{ item.selling_plan_allocation.selling_plan.name }}
                    </div>
                  {%- endif -%}

                  <div class="sunrise-cart-drawer__item-price">
                    {%- if item.original_price != item.final_price -%}
                      <span class="sunrise-cart-drawer__item-price--sale">
                        {{ item.final_price | money }}
                      </span>
                      <span class="sunrise-cart-drawer__item-price--compare">
                        {{ item.original_price | money }}
                      </span>
                    {%- else -%}
                      <span class="sunrise-cart-drawer__item-price--regular">
                        {{ item.final_price | money }}
                      </span>
                    {%- endif -%}
                  </div>

                  <div class="sunrise-cart-drawer__item-quantity">
                    <label for="CartDrawerQuantity-{{ item.index | plus: 1 }}" class="visually-hidden">
                      {{ 'products.product.quantity.label' | t }}
                    </label>
                    <div class="sunrise-cart-drawer__quantity-wrapper">
                      <button type="button" class="sunrise-cart-drawer__quantity-button sunrise-cart-drawer__quantity-button--minus" data-index="{{ item.index | plus: 1 }}">
                        <svg class="sunrise-cart-drawer__quantity-icon" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="4" y1="6" x2="8" y2="6"></line>
                        </svg>
                      </button>
                      <input
                        type="number"
                        id="CartDrawerQuantity-{{ item.index | plus: 1 }}"
                        name="updates[]"
                        value="{{ item.quantity }}"
                        min="0"
                        class="sunrise-cart-drawer__quantity-input"
                        data-index="{{ item.index | plus: 1 }}"
                      >
                      <button type="button" class="sunrise-cart-drawer__quantity-button sunrise-cart-drawer__quantity-button--plus" data-index="{{ item.index | plus: 1 }}">
                        <svg class="sunrise-cart-drawer__quantity-icon" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="6" y1="4" x2="6" y2="8"></line>
                          <line x1="4" y1="6" x2="8" y2="6"></line>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="sunrise-cart-drawer__item-actions">
                  <button type="button" class="sunrise-cart-drawer__remove" data-index="{{ item.index | plus: 1 }}" aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}">
                    <svg class="sunrise-cart-drawer__remove-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 6h10M8 6v6m0-6V4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2M8 6H6a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H8"/>
                    </svg>
                  </button>
                </div>
              </div>
            {%- endfor -%}
          </div>
        </form>
      {%- else -%}
        <div class="sunrise-cart-drawer__empty">
          <div class="sunrise-cart-drawer__empty-content">
            <svg class="sunrise-cart-drawer__empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <circle cx="9" cy="21" r="1"/>
              <circle cx="20" cy="21" r="1"/>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
            <h3>{{ 'sections.cart.empty' | t }}</h3>
            <p>{{ 'sections.cart.continue_shopping' | t }}</p>
            <a href="{{ routes.all_products_collection_url }}" class="sunrise-button">
              {{ 'general.continue_shopping' | t }}
            </a>
          </div>
        </div>
      {%- endif -%}
    </div>

    {%- if cart.item_count > 0 -%}
      <div class="sunrise-cart-drawer__footer">
        <div class="sunrise-cart-drawer__totals">
          <div class="sunrise-cart-drawer__subtotal">
            <span class="sunrise-cart-drawer__subtotal-label">{{ 'sections.cart.subtotal' | t }}</span>
            <span class="sunrise-cart-drawer__subtotal-price">{{ cart.total_price | money }}</span>
          </div>
          
          {%- if cart.total_discounts > 0 -%}
            <div class="sunrise-cart-drawer__discounts">
              <span class="sunrise-cart-drawer__discounts-label">{{ 'sections.cart.savings' | t: savings: cart.total_discounts | money }}</span>
            </div>
          {%- endif -%}
        </div>

        <div class="sunrise-cart-drawer__checkout">
          <button type="submit" form="CartDrawerForm" class="sunrise-cart-drawer__checkout-button sunrise-button sunrise-button--full-width">
            {{ 'sections.cart.checkout' | t }}
          </button>
        </div>

        {%- if settings.show_dynamic_checkout -%}
          <div class="sunrise-cart-drawer__dynamic-checkout">
            {{ form | payment_button }}
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
</cart-drawer>

<script src="{{ 'sunrise-cart-drawer.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "Cart drawer",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Cart drawer settings"
    },
    {
      "type": "checkbox",
      "id": "show_cart_note",
      "default": true,
      "label": "Show cart note"
    },
    {
      "type": "checkbox",
      "id": "show_dynamic_checkout",
      "default": true,
      "label": "Show dynamic checkout buttons"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show vendor"
    },
    {
      "type": "select",
      "id": "cart_drawer_position",
      "options": [
        {
          "value": "right",
          "label": "Right"
        },
        {
          "value": "left",
          "label": "Left"
        }
      ],
      "default": "right",
      "label": "Cart drawer position"
    }
  ],
  "presets": [
    {
      "name": "Cart drawer"
    }
  ]
}
{% endschema %}
